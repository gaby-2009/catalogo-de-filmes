<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo de Filmes - Busca por API</title>
    
    <link rel="stylesheet" href="style.css"> 
    <style>
        /* Estilos existentes e adicionais para melhor visualização */
        #busca-filme {
            width: 100%;
            padding: 10px;
            margin-bottom: 20px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 16px;
        }
        .filme-card {
            display: flex;
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 2px 2px 5px rgba(0,0,0,0.1);
        }
        .filme-imagem {
            width: 100px; 
            height: 150px;
            object-fit: cover;
            margin-right: 15px;
            border-radius: 4px;
        }
        .filme-info {
            flex-grow: 1;
        }
        .nota {
            margin: 5px 0;
        }
        .estrela {
            font-size: 1.2em;
            color: gray;
        }
        .cheia {
            color: gold;
        }
        .metade {
            color: orange; 
        }
        .vazia {
            color: #ddd;
        }

        /* NOVOS ESTILOS PARA A BUSCA API */
        #busca-api-container {
            margin-bottom: 20px;
            padding: 15px;
            border: 1px solid #cce5ff;
            background-color: #e6f2ff;
            border-radius: 6px;
        }
        #busca-api-container input[type="text"] {
            width: 70%;
            padding: 8px;
            margin-right: 10px;
            border: 1px solid #c299ff;
            border-radius: 4px;
        }
        #busca-api-container button {
            padding: 8px 15px;
            background-color: #9000ff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        #resultado-api {
            margin-top: 10px;
            font-weight: bold;
            color: #690e84;
        }
    </style>
</head>
<body>
    <h1>𝒞𝒶𝓉𝒶́𝓁ℴℊℴ 𝒹ℯ ℱ𝒾𝓁𝓂ℯ𝓈</h1>
    
    <div id="busca-api-container">
        <h2>Adicionar Filme por Busca</h2>
        <input type="text" id="input-busca-api" placeholder="Digite o título do filme a buscar (Ex: The Matrix)">
        <button id="btn-buscar-api">Buscar e Adicionar</button>
        <p id="resultado-api"></p>
    </div>
    
    <hr> <h2>ℳ𝒾𝓃𝒽𝒶 𝓁𝒾𝓈𝓉𝒶 𝒹ℯ 𝒻𝒾𝓁𝓂ℯ𝓈</h2>
    <input type="text" id="busca-filme" placeholder="Filtre os filmes por título...">
    <div id="lista-filmes">
        <p id="mensagem-vazia" style="display: none;"></p>
    </div>
    <hr>
    
    <script>

    const OMDb_API_KEY = '4c42996f'; 
    const catalogo = [];

    // Adiciona um filme de exemplo para iniciar
    catalogo.push({
        titulo: "Um Mistério de Cores",
        imagemURL: "https://i.imgur.com/gK9u5lA.png", 
        sinopse: "Um detetive obcecado por cores deve desvendar a verdade por trás de um crime em que a única pista é uma mancha de cor primária em uma tela vazia.",
        diretor: "Ava Violeta",
        duracao: 118, 
        faixaEtaria: "14 anos",
        ano: 2024, 
        genero: "Suspense",
        nota: 8.5,
        // NOVO CAMPO ADICIONADO para o trailer do filme de exemplo
        trailerURL: 'https://www.youtube.com/results?search_query=Um+Misterio+de+Cores+trailer',
    });

    // CAPTURA DE ELEMENTOS DO DOM (Gerais)
    const listaFilmesContainer = document.getElementById('lista-filmes');
    const mensagemVazia = document.getElementById('mensagem-vazia');
    const inputBuscaLocal = document.getElementById('busca-filme');

    // CAPTURA DE ELEMENTOS DO DOM (Busca API)
    const inputBuscaApi = document.getElementById('input-busca-api');
    const btnBuscarApi = document.getElementById('btn-buscar-api');
    const resultadoApi = document.getElementById('resultado-api');


    // ====================================
    // II. FUNÇÕES AUXILIARES
    // ====================================

    function gerarEstrelas(nota) {
        const notaArredondada = Math.round(nota * 2) / 2;
        let estrelasHtml = '';
        for (let i = 1; i <= 5; i++) {
            if (i <= notaArredondada) {
                estrelasHtml += '<span class="estrela cheia">★</span>';
            } else if (i - 0.5 === notaArredondada) {
                estrelasHtml += '<span class="estrela metade">★</span>';
            } else {
                estrelasHtml += '<span class="estrela vazia">★</span>';
            }
        }
        estrelasHtml += `<span class="nota-valor"> (${nota.toFixed(1)}/10)</span>`;
        return estrelasHtml;
    }

    function formatarDuracao(minutos) {
        const horas = Math.floor(minutos / 60);
        const mins = minutos % 60;
        return `${horas > 0 ? horas + 'h ' : ''}${mins > 0 ? mins + 'min' : (horas === 0 ? '0min' : '')}`.trim();
    }

    function removerFilme(tituloRemover) {
        const index = catalogo.findIndex(filme => filme.titulo === tituloRemover);
        if (index !== -1) {
            catalogo.splice(index, 1);
            renderizarCatalogo();
        }
    }
    
    // FUNÇÃO DE RENDERIZAÇÃO (Desenha o HTML)
    function renderizarCatalogo() {
        listaFilmesContainer.innerHTML = '';
        
        const termoBusca = inputBuscaLocal.value.toLowerCase().trim();
        const filmesFiltrados = catalogo.filter(filme => 
            filme.titulo.toLowerCase().includes(termoBusca)
        );
        
        if (filmesFiltrados.length === 0) {
            mensagemVazia.textContent = termoBusca ? 
                `Nenhum filme encontrado com o título "${termoBusca}".` : 
                "Nenhum filme cadastrado ainda.";
                
            listaFilmesContainer.appendChild(mensagemVazia);
            mensagemVazia.style.display = 'block';
            return;
        } else {
            mensagemVazia.style.display = 'none';
        }

        filmesFiltrados.forEach((filme) => {
            const filmeCard = document.createElement('div');
            filmeCard.classList.add('filme-card');
            
            const duracaoFormatada = formatarDuracao(filme.duracao);
            const estrelasHtml = gerarEstrelas(filme.nota); 
            
            // Adicionado o botão/link do trailer
            const trailerButtonHtml = filme.trailerURL ? 
                `<a href="${filme.trailerURL}" target="_blank" class="btn-trailer">▶️ Ver Trailer</a>` : 
                '';

            filmeCard.innerHTML = `
                <img src="${filme.imagemURL}" alt="Poster do filme ${filme.titulo}" class="filme-imagem">
                <div class="filme-info">
                    <h3>${filme.titulo} (${filme.ano})</h3>
                    <p><strong>Diretor:</strong> ${filme.diretor}</p>
                    <p><strong>Gênero:</strong> ${filme.genero} | <strong>Faixa Etária:</strong> ${filme.faixaEtaria}</p>
                    <p><strong>Duração:</strong> ${duracaoFormatada}</p>
                    
                    <p class="nota"><strong>Nota:</strong> ${estrelasHtml}</p>
                    
                    <p><strong>Sinopse:</strong> ${filme.sinopse}</p>
                    
                    <div style="margin-top: 10px;">
                        ${trailerButtonHtml}
                        <button class="btn-remover">Remover</button>
                    </div>
                </div>
            `;
            
            const btnRemover = filmeCard.querySelector('.btn-remover');
            btnRemover.addEventListener('click', () => {
                removerFilme(filme.titulo); 
            });

            listaFilmesContainer.appendChild(filmeCard);
        });
    }

    // ====================================
    // III. FUNÇÕES DE BUSCA API OMDb
    // ====================================

    async function buscarFilmeOMDb() {
        const tituloBusca = inputBuscaApi.value.trim();
        resultadoApi.textContent = ''; 
        
        if (!tituloBusca) {
            resultadoApi.textContent = "Digite o título do filme.";
            return;
        }
        
        // Verifica se o filme já existe no catálogo local
        if (catalogo.some(filme => filme.titulo.toLowerCase() === tituloBusca.toLowerCase())) {
            resultadoApi.textContent = `⚠️ O filme "${tituloBusca}" já está na sua lista.`;
            return;
        }

        resultadoApi.textContent = "Buscando...";
        btnBuscarApi.disabled = true;

        try {
            const url = `https://www.omdbapi.com/?t=${encodeURIComponent(tituloBusca)}&apikey=${OMDb_API_KEY}`;
            const response = await fetch(url);
            const dados = await response.json();

            if (dados.Response === "True") {
                
                const duracaoMinutos = dados.Runtime.match(/\d+/) ? parseInt(dados.Runtime.match(/\d+/)[0]) : 0;
                
                let notaOmdb = 0;
                if (dados.imdbRating && dados.imdbRating !== 'N/A') {
                    notaOmdb = parseFloat(dados.imdbRating);
                } else if (dados.Ratings && dados.Ratings.length > 0) {
                    const rating = dados.Ratings.find(r => r.Source.includes('Internet Movie Database'));
                    if (rating) {
                            // Tenta parsear a nota (geralmente X/10 ou X.X)
                        notaOmdb = parseFloat(rating.Value.split('/')[0]) || parseFloat(rating.Value);
                    }
                }

                // Cria o link de busca do YouTube para o trailer
                const trailerLink = `https://www.youtube.com/results?search_query=${encodeURIComponent(dados.Title + ' official trailer')}`;


                // Mapeamento dos dados para o formato do seu catálogo
                const novoFilmeOmdb = {
                    titulo: dados.Title,
                    imagemURL: dados.Poster !== 'N/A' ? dados.Poster : 'https://via.placeholder.com/100x150?text=Sem+Poster', 
                    sinopse: dados.Plot !== 'N/A' ? dados.Plot : 'Sinopse não disponível.',
                    diretor: dados.Director !== 'N/A' ? dados.Director : 'Desconhecido',
                    duracao: duracaoMinutos, 
                    // Mapeia faixa etária do OMDb (ex: "PG-13", "R") para algo mais legível ou mantém
                    faixaEtaria: dados.Rated !== 'N/A' ? dados.Rated : 'Livre', 
                    ano: parseInt(dados.Year), 
                    genero: dados.Genre.split(', ')[0] || 'Outro', 
                    nota: notaOmdb,
                    // NOVO CAMPO: Adiciona o link do trailer
                    trailerURL: trailerLink,
                };

                catalogo.push(novoFilmeOmdb);
                renderizarCatalogo();
                
                resultadoApi.textContent = `✅ Filme "${dados.Title}" adicionado com sucesso!`;
                inputBuscaApi.value = ''; 
                
            } else {
                resultadoApi.textContent = `❌ Filme não encontrado: ${dados.Error || 'Erro desconhecido.'}`;
            }
        } catch (error) {
            console.error("Erro ao buscar filme na OMDb API:", error);
            resultadoApi.textContent = "⚠️ Erro de conexão ou na API.";
        } finally {
            btnBuscarApi.disabled = false;
        }
    }
    
    
    // ====================================
    // V. EVENT LISTENERS
    // ====================================
    
    // 1. Busca Local (Filtro)
    inputBuscaLocal.addEventListener('input', renderizarCatalogo); 

    // 2. Busca API (Botão e Enter)
    btnBuscarApi.addEventListener('click', buscarFilmeOMDb);
    inputBuscaApi.addEventListener('keypress', (event) => {
        if (event.key === 'Enter') {
            event.preventDefault(); 
            buscarFilmeOMDb();
        }
    });

    // Removido listener do formManual (não existe no HTML fornecido)
    // formManual.addEventListener('submit', handleCadastroManual);
    
    // ====================================
    // VI. RENDERIZAÇÃO INICIAL
    // ====================================
    
    renderizarCatalogo();
</script>

    <div class="link-container">
    <a href="manual.html">Ir para a Próxima Página</a>
</div>

</body>
</html>