<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo de Filmes - FILMFLIX</title>
    
    <style>
        /* CSS GLOBAL E VARIÁVEIS PARA TEMA ESCURO */
        *,
        *::before,
        *::after {
            box-sizing: border-box;
        }

        :root {
            --cor-fundo-site: #1a1a1a; /* Preto/Grafite do fundo */
            --cor-fundo-header: #222222; /* Cor mais clara para o header/busca/cartão */
            --cor-texto: #ffffff; /* Texto principal branco */
            --cor-primaria: #03a9f4; /* Azul/Ciano (Destaque principal) */
            --cor-secundaria: #ff0077; /* Rosa Vibrante (Destaque secundário/Nota) */
            --cor-borda: #444444;
            --cor-input-bg: #333;
            
            --cor-erro: #e74c3c; 
            --cor-erro-hover: #c0392b;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0; 
            background-color: var(--cor-fundo-site);
            color: var(--cor-texto);
        }
        
        /* ------------------------------------
        * Estilos do HEADER (Simulação da barra FILMFLIX)
        * ------------------------------------
        */
        header {
            background-color: var(--cor-fundo-header);
            padding: 10px 40px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.4);
            margin-bottom: 20px;
        }

        .logo {
            font-size: 2em;
            font-weight: bold;
            color: var(--cor-primaria);
            letter-spacing: -1px;
        }

        .nav-links a {
            color: var(--cor-texto);
            text-decoration: none;
            margin-left: 20px;
            font-size: 1.1em;
            transition: color 0.3s;
        }

        .nav-links a:hover {
            color: var(--cor-secundaria);
        }

        h2 {
            color: var(--cor-primaria);
            border-bottom: none;
            padding-bottom: 0;
            margin-top: 0;
            font-size: 1.5em;
        }

        hr {
            border: 0;
            border-top: 1px solid var(--cor-borda);
            margin: 0 40px 20px 40px;
        }

        /* -------------------------------------- */
        /* ESTILOS DA BUSCA API E BUSCA LOCAL/FILTROS */
        /* -------------------------------------- */

        #busca-api-container {
            background-color: var(--cor-fundo-header);
            padding: 20px 40px;
        }

        #busca-api-container input[type="text"],
        #busca-api-container button {
            padding: 10px 15px;
            border-radius: 6px;
            font-size: 16px;
        }

        #input-busca-api {
            width: 70%;
            margin-right: 10px;
            border: 1px solid var(--cor-borda);
            background-color: var(--cor-input-bg);
            color: var(--cor-texto);
        }
        
        #btn-buscar-api {
            background-color: var(--cor-secundaria); /* Rosa Vibrante */
            color: white;
            border: none;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #btn-buscar-api:hover {
            background-color: #ff3399;
        }
        
        #resultado-api {
            margin-top: 10px;
            font-weight: bold;
            color: var(--cor-primaria);
        }

        .catalogo-header {
            display: flex;
            gap: 15px;
            padding: 20px 40px;
            background-color: var(--cor-fundo-header);
            align-items: center;
        }

        #busca-filme,
        .filtro-dropdown {
            padding: 10px 15px;
            border: 1px solid var(--cor-borda);
            border-radius: 6px;
            font-size: 16px;
            background-color: var(--cor-input-bg);
            color: white;
        }

        #busca-filme {
            flex-grow: 1; /* Ocupa o espaço restante */
        }
        
        /* -------------------------------------- */
        /* ESTILOS DA LISTA DE FILMES (GRADE/GRID) */
        /* -------------------------------------- */
        #lista-filmes {
            margin: 20px 40px; 
            display: grid; 
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); 
            gap: 20px; 
            padding: 0;
        }

        .filme-card {
            display: block; 
            padding: 0; 
            border: none; 
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3); 
            overflow: hidden; 
            text-align: left;
            background-color: var(--cor-fundo-header); 
            position: relative; /* CRUCIAL para a nota sobreposta */
            transition: transform 0.2s;
        }

        .filme-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 16px rgba(0, 0, 0, 0.5);
        }

        .filme-imagem {
            width: 100%; 
            height: 300px; 
            object-fit: cover;
            margin-right: 0;
            border-radius: 0;
        }

        .filme-info {
            padding: 10px 10px 15px 10px;
        }

        .filme-card h3 {
            margin: 5px 0;
            font-size: 1.1em;
            color: var(--cor-texto); 
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis; 
            height: 1.5em; /* Garante altura uniforme para todos os títulos */
        }

        /* Oculta detalhes para o visual de cartão */
        .filme-info p {
            display: none !important; 
        }

        /* Oculta os botões do visual de grade */
        .btn-remover, .btn-trailer {
            display: none !important;
        }
        
        /* -------------------------------------- */
        /* NOTA SOBREPOSTA (Como no mockup 6.8) */
        /* -------------------------------------- */
        .nota-sobreposta {
            position: absolute;
            top: 15px;
            right: 15px;
            background-color: var(--cor-fundo-header);
            color: var(--cor-secundaria); 
            padding: 5px 10px;
            border-radius: 4px;
            font-weight: bold;
            font-size: 1.1em;
            z-index: 10;
            box-shadow: 0 0 5px rgba(0,0,0,0.5);
            border: 1px solid var(--cor-secundaria);
        }

        /* -------------------------------------- */
        /* ESTILOS DIVERSOS */
        /* -------------------------------------- */
        
        /* Estilo para o link para a página manual */
        .link-container {
            background-color: var(--cor-secundaria);
            padding: 10px 20px;       
            border-radius: 6px;       
            display: inline-block;    
            margin: 20px 40px;           
        }

        .link-container a {
            color: white;             
            text-decoration: none;    
            font-weight: bold;        
        }

        .link-container:hover {
            background-color: #ff3399; 
            cursor: pointer;
        }
        
        /* Responsividade básica */
        @media (max-width: 768px) {
            header, #busca-api-container, .catalogo-header {
                padding: 10px 20px;
            }
            #lista-filmes {
                margin: 10px 20px;
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
                gap: 15px;
            }
            .filme-imagem {
                height: 220px;
            }
            .catalogo-header {
                flex-direction: column;
                align-items: stretch;
            }
            #busca-filme {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <header>
        <div class="logo">► FILMFLIX</div>
        <nav class="nav-links">
            <a href="#">Minha Lista</a>
            <a href="#">Gêneros</a>
            <a href="#">Sobre</a>
        </nav>
    </header>
    
    <div id="busca-api-container">
        <h2>Adicionar Filme por Busca (OMDb)</h2>
        <input type="text" id="input-busca-api" placeholder="Digite o título do filme a buscar (Ex: The Matrix)">
        <button id="btn-buscar-api">Buscar e Adicionar</button>
        <p id="resultado-api"></p>
    </div>
    
    <hr> 
    
    <div class="catalogo-header">
        <input type="text" id="busca-filme" placeholder="Filtre os filmes por título...">
        <select class="filtro-dropdown">
            <option>Gênero</option>
            <option>Ação</option>
            <option>Comédia</option>
        </select>
        <select class="filtro-dropdown">
            <option>Ordenar</option>
            <option>Nota (Maior)</option>
            <option>Ano (Recente)</option>
        </select>
    </div>
    
    <div id="lista-filmes">
        <p id="mensagem-vazia" style="display: none;"></p>
    </div>
    
    <div class="link-container">
        <a href="manual.html">Ir para Cadastro Manual</a>
    </div>

    <script>

    const OMDb_API_KEY = '4c42996f'; 
    const catalogo = [];

    // Adiciona um filme de exemplo para iniciar
    catalogo.push({
        titulo: "Um Mistério de Cores",
        imagemURL: "https://i.imgur.com/gK9u5lA.png", 
        sinopse: "Um detetive obcecado por cores deve desvendar a verdade por trás de um crime em que a única pista é uma mancha de cor primária em uma tela vazia.",
        diretor: "Ava Violeta",
        duracao: 118, 
        faixaEtaria: "14 anos",
        ano: 2024, 
        genero: "Suspense",
        nota: 8.5,
        trailerURL: 'https://www.youtube.com/results?search_query=Um+Misterio+de+Cores+trailer',
    });

    // CAPTURA DE ELEMENTOS DO DOM (Gerais)
    const listaFilmesContainer = document.getElementById('lista-filmes');
    const mensagemVazia = document.getElementById('mensagem-vazia');
    const inputBuscaLocal = document.getElementById('busca-filme');

    // CAPTURA DE ELEMENTOS DO DOM (Busca API)
    const inputBuscaApi = document.getElementById('input-busca-api');
    const btnBuscarApi = document.getElementById('btn-buscar-api');
    const resultadoApi = document.getElementById('resultado-api');


    // ====================================
    // II. FUNÇÕES AUXILIARES
    // ====================================

    function gerarEstrelas(nota) {
        const notaArredondada = Math.round(nota * 2) / 2;
        let estrelasHtml = '';
        for (let i = 1; i <= 5; i++) {
            if (i <= notaArredondada) {
                estrelasHtml += '<span class="estrela cheia">★</span>';
            } else if (i - 0.5 === notaArredondada) {
                estrelasHtml += '<span class="estrela metade">★</span>';
            } else {
                estrelasHtml += '<span class="estrela vazia">★</span>';
            }
        }
        estrelasHtml += `<span class="nota-valor"> (${nota.toFixed(1)}/10)</span>`;
        return estrelasHtml;
    }

    function formatarDuracao(minutos) {
        const horas = Math.floor(minutos / 60);
        const mins = minutos % 60;
        return `${horas > 0 ? horas + 'h ' : ''}${mins > 0 ? mins + 'min' : (horas === 0 ? '0min' : '')}`.trim();
    }

    function removerFilme(tituloRemover) {
        const index = catalogo.findIndex(filme => filme.titulo === tituloRemover);
        if (index !== -1) {
            catalogo.splice(index, 1);
            renderizarCatalogo();
        }
    }
    
    // FUNÇÃO DE RENDERIZAÇÃO (Desenha o HTML) - ATUALIZADA PARA A NOTA SOBREPOSTA
    function renderizarCatalogo() {
        listaFilmesContainer.innerHTML = '';
        
        const termoBusca = inputBuscaLocal.value.toLowerCase().trim();
        const filmesFiltrados = catalogo.filter(filme => 
            filme.titulo.toLowerCase().includes(termoBusca)
        );
        
        if (filmesFiltrados.length === 0) {
            mensagemVazia.textContent = termoBusca ? 
                `Nenhum filme encontrado com o título "${termoBusca}".` : 
                "Nenhum filme cadastrado ainda.";
                
            listaFilmesContainer.appendChild(mensagemVazia);
            mensagemVazia.style.display = 'block';
            return;
        } else {
            mensagemVazia.style.display = 'none';
        }

        filmesFiltrados.forEach((filme) => {
            const filmeCard = document.createElement('div');
            filmeCard.classList.add('filme-card');
            
            // NOVO: Balão de nota sobreposta (como no mockup)
            const notaSobreposta = `<div class="nota-sobreposta">${filme.nota.toFixed(1)}</div>`;
            
            const duracaoFormatada = formatarDuracao(filme.duracao);
            const estrelasHtml = gerarEstrelas(filme.nota); 
            
            const trailerButtonHtml = filme.trailerURL ? 
                `<a href="${filme.trailerURL}" target="_blank" class="btn-trailer">▶️ Ver Trailer</a>` : 
                '';

            filmeCard.innerHTML = `
                ${notaSobreposta}
                <img src="${filme.imagemURL}" alt="Poster do filme ${filme.titulo}" class="filme-imagem">
                <div class="filme-info">
                    <h3>${filme.titulo}</h3>
                    <p><strong>Diretor:</strong> ${filme.diretor}</p>
                    <p><strong>Gênero:</strong> ${filme.genero} | <strong>Faixa Etária:</strong> ${filme.faixaEtaria}</p>
                    <p><strong>Duração:</strong> ${duracaoFormatada}</p>
                    
                    <p class="nota"><strong>Nota:</strong> ${estrelasHtml}</p>
                    
                    <p><strong>Sinopse:</strong> ${filme.sinopse}</p>
                    
                    <div style="margin-top: 10px;">
                        ${trailerButtonHtml}
                        <button class="btn-remover">Remover</button>
                    </div>
                </div>
            `;
            
            const btnRemover = filmeCard.querySelector('.btn-remover');
            btnRemover.addEventListener('click', () => {
                removerFilme(filme.titulo); 
            });

            listaFilmesContainer.appendChild(filmeCard);
        });
    }

    // ====================================
    // III. FUNÇÕES DE BUSCA API OMDb
    // ====================================

    async function buscarFilmeOMDb() {
        const tituloBusca = inputBuscaApi.value.trim();
        resultadoApi.textContent = ''; 
        
        if (!tituloBusca) {
            resultadoApi.textContent = "Digite o título do filme.";
            return;
        }
        
        // Verifica se o filme já existe no catálogo local
        if (catalogo.some(filme => filme.titulo.toLowerCase() === tituloBusca.toLowerCase())) {
            resultadoApi.textContent = `⚠️ O filme "${tituloBusca}" já está na sua lista.`;
            return;
        }

        resultadoApi.textContent = "Buscando...";
        btnBuscarApi.disabled = true;

        try {
            const url = `https://www.omdbapi.com/?t=${encodeURIComponent(tituloBusca)}&apikey=${OMDb_API_KEY}`;
            const response = await fetch(url);
            const dados = await response.json();

            if (dados.Response === "True") {
                
                const duracaoMinutos = dados.Runtime.match(/\d+/) ? parseInt(dados.Runtime.match(/\d+/)[0]) : 0;
                
                let notaOmdb = 0;
                if (dados.imdbRating && dados.imdbRating !== 'N/A') {
                    notaOmdb = parseFloat(dados.imdbRating);
                } else if (dados.Ratings && dados.Ratings.length > 0) {
                    const rating = dados.Ratings.find(r => r.Source.includes('Internet Movie Database'));
                    if (rating) {
                        notaOmdb = parseFloat(rating.Value.split('/')[0]) || parseFloat(rating.Value);
                    }
                }

                // Cria o link de busca do YouTube para o trailer
                const trailerLink = `https://www.youtube.com/results?search_query=${encodeURIComponent(dados.Title + ' official trailer')}`;


                // Mapeamento dos dados para o formato do seu catálogo
                const novoFilmeOmdb = {
                    titulo: dados.Title,
                    imagemURL: dados.Poster !== 'N/A' ? dados.Poster : 'https://via.placeholder.com/200x300?text=Sem+Poster', 
                    sinopse: dados.Plot !== 'N/A' ? dados.Plot : 'Sinopse não disponível.',
                    diretor: dados.Director !== 'N/A' ? dados.Director : 'Desconhecido',
                    duracao: duracaoMinutos, 
                    faixaEtaria: dados.Rated !== 'N/A' ? dados.Rated : 'Livre', 
                    ano: parseInt(dados.Year), 
                    genero: dados.Genre.split(', ')[0] || 'Outro', 
                    nota: notaOmdb,
                    trailerURL: trailerLink,
                };

                catalogo.push(novoFilmeOmdb);
                renderizarCatalogo();
                
                resultadoApi.textContent = `✅ Filme "${dados.Title}" adicionado com sucesso!`;
                inputBuscaApi.value = ''; 
                
            } else {
                resultadoApi.textContent = `❌ Filme não encontrado: ${dados.Error || 'Erro desconhecido.'}`;
            }
        } catch (error) {
            console.error("Erro ao buscar filme na OMDb API:", error);
            resultadoApi.textContent = "⚠️ Erro de conexão ou na API.";
        } finally {
            btnBuscarApi.disabled = false;
        }
    }
    
    
    // ====================================
    // V. EVENT LISTENERS
    // ====================================
    
    // 1. Busca Local (Filtro)
    inputBuscaLocal.addEventListener('input', renderizarCatalogo); 

    // 2. Busca API (Botão e Enter)
    btnBuscarApi.addEventListener('click', buscarFilmeOMDb);
    inputBuscaApi.addEventListener('keypress', (event) => {
        if (event.key === 'Enter') {
            event.preventDefault(); 
            buscarFilmeOMDb();
        }
    });
    
    // ====================================
    // VI. RENDERIZAÇÃO INICIAL
    // ====================================
    
    renderizarCatalogo();
</script>

</body>
</html>